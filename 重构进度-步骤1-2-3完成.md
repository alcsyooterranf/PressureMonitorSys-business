# DDDæ¶æ„é‡æ„ - æ­¥éª¤1-2-3å®ŒæˆæŠ¥å‘Š

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### æ­¥éª¤1ï¼šåˆ›å»ºCommandå¯¹è±¡ âœ…

#### 1.1 æŒ‡ä»¤æ¨¡å— (Command Module)
**ä½ç½®ï¼š** `business-domain/src/main/java/org/pms/domain/command/model/command/`

- âœ… `CreateCommandMetaCommand.java` - åˆ›å»ºæŒ‡ä»¤å…ƒæ•°æ®
- âœ… `UpdateCommandMetaCommand.java` - æ›´æ–°æŒ‡ä»¤å…ƒæ•°æ®
- âœ… `CreateCommandTaskCommand.java` - åˆ›å»ºæŒ‡ä»¤ä»»åŠ¡
- âœ… `SendCommandCommand.java` - å‘é€æŒ‡ä»¤

**ç‰¹ç‚¹ï¼š**
- ä½¿ç”¨ `@Value` æ³¨è§£ï¼Œä¸å¯å˜å¯¹è±¡
- ä½¿ç”¨ `@Builder` æ³¨è§£ï¼Œæ”¯æŒæ„å»ºå™¨æ¨¡å¼
- åªåŒ…å«æ•°æ®ï¼Œæ²¡æœ‰ä¸šåŠ¡é€»è¾‘
- å®Œå…¨æ›¿ä»£APIå±‚çš„DTO

---

#### 1.2 è®¾å¤‡æ¨¡å— (Device Module)
**ä½ç½®ï¼š** `business-domain/src/main/java/org/pms/domain/terminal/model/command/`

- âœ… `CreateDeviceCommand.java` - åˆ›å»ºè®¾å¤‡
- âœ… `UpdateDeviceCommand.java` - æ›´æ–°è®¾å¤‡

**å­—æ®µæ˜ å°„ï¼š**
```
DeviceInsertReq â†’ CreateDeviceCommand
- pipelineId, pipelineSN, deviceSN
- temperatureUpperBound, temperatureLowerBound
- voltageUpperBound, voltageLowerBound
- pressureUpperBound, pressureLowerBound
- localAtmosphericPressure
- longitude, latitude
- remark
```

---

#### 1.3 ç®¡é“æ¨¡å— (Pipeline Module)
**ä½ç½®ï¼š** `business-domain/src/main/java/org/pms/domain/terminal/model/command/`

- âœ… `CreatePipelineCommand.java` - åˆ›å»ºç®¡é“
- âœ… `UpdatePipelineCommand.java` - æ›´æ–°ç®¡é“

**å­—æ®µæ˜ å°„ï¼š**
```
PipelineInsertReq â†’ CreatePipelineCommand
- pipelineSN, pipelineName
- customerAccount, location
- remark

PipelineUpdateReq â†’ UpdatePipelineCommand
- id, pipelineName, location
- longitude, latitude
- remark
```

---

### æ­¥éª¤2ï¼šåˆ›å»ºApplicationå±‚DTOè½¬æ¢å™¨ âœ…

#### 2.1 æŒ‡ä»¤æ¨¡å—è½¬æ¢å™¨
**æ–‡ä»¶ï¼š** `business-application/src/main/java/org/pms/application/converter/CommandDtoConverter.java`

**è½¬æ¢æ–¹æ³•ï¼š**
```java
âœ… toCreateCommand(CommandMetaInsertReq) â†’ CreateCommandMetaCommand
âœ… toUpdateCommand(CommandMetaUpdateReq) â†’ UpdateCommandMetaCommand
âœ… toCreateTaskCommand(CommandTaskCreateReq) â†’ CreateCommandTaskCommand
âœ… toSendCommand(CommandTaskSendReq) â†’ SendCommandCommand
```

---

#### 2.2 è®¾å¤‡/ç®¡é“æ¨¡å—è½¬æ¢å™¨
**æ–‡ä»¶ï¼š** `business-application/src/main/java/org/pms/application/converter/TerminalDtoConverter.java`

**è½¬æ¢æ–¹æ³•ï¼š**
```java
âœ… toCreateCommand(DeviceInsertReq) â†’ CreateDeviceCommand
âœ… toUpdateCommand(DeviceUpdateReq) â†’ UpdateDeviceCommand
âœ… toCreateCommand(PipelineInsertReq) â†’ CreatePipelineCommand
âœ… toUpdateCommand(PipelineUpdateReq) â†’ UpdatePipelineCommand
```

---

### æ­¥éª¤3ï¼šä¿®æ”¹Serviceæ¥å£ï¼Œä½¿ç”¨Commandå¯¹è±¡ âœ…

#### 3.1 æŒ‡ä»¤å…ƒæ•°æ®æœåŠ¡æ¥å£
**æ–‡ä»¶ï¼š** `business-domain/src/main/java/org/pms/domain/command/service/ICommandMetaService.java`

**ä¿®æ”¹å‰ï¼š**
```java
âŒ void createCommandMeta(CommandMetaInsertReq commandMetaInsertReq);
âŒ void updateCommandMeta(CommandMetaUpdateReq commandMetaUpdateReq);
```

**ä¿®æ”¹åï¼š**
```java
âœ… void createCommandMeta(CreateCommandMetaCommand command);
âœ… void updateCommandMeta(UpdateCommandMetaCommand command);
```

---

#### 3.2 æŒ‡ä»¤ä»»åŠ¡æœåŠ¡æ¥å£
**æ–‡ä»¶ï¼š** `business-domain/src/main/java/org/pms/domain/command/service/ICommandTaskService.java`

**ä¿®æ”¹å‰ï¼š**
```java
âŒ Long createCommandTask(CommandTaskCreateReq commandTaskCreateReq);
âŒ Long sendCommand(CommandTaskSendReq commandTaskSendReq);
âŒ CompletableFuture<Long> sendCommandAsync(CommandTaskSendReq commandTaskSendReq);
```

**ä¿®æ”¹åï¼š**
```java
âœ… Long createCommandTask(CreateCommandTaskCommand command);
âœ… Long sendCommand(SendCommandCommand command);
âœ… CompletableFuture<Long> sendCommandAsync(SendCommandCommand command);
```

---

#### 3.3 è®¾å¤‡æœåŠ¡æ¥å£
**æ–‡ä»¶ï¼š** `business-domain/src/main/java/org/pms/domain/terminal/service/IDeviceService.java`

**ä¿®æ”¹å‰ï¼š**
```java
âŒ void addDevice(DeviceInsertReq deviceInsertReq);
âŒ void updateDevice(DeviceUpdateReq deviceUpdateReq, String securityContextEncoded);
```

**ä¿®æ”¹åï¼š**
```java
âœ… void addDevice(CreateDeviceCommand command);
âœ… void updateDevice(UpdateDeviceCommand command, String securityContextEncoded);
```

---

#### 3.4 ç®¡é“æœåŠ¡æ¥å£
**æ–‡ä»¶ï¼š** `business-domain/src/main/java/org/pms/domain/terminal/service/IPipelineService.java`

**ä¿®æ”¹å‰ï¼š**
```java
âŒ void addPipeline(PipelineInsertReq pipelineInsertReq);
âŒ void updatePipeline(PipelineUpdateReq pipelineUpdateReq, String securityContextEncoded);
```

**ä¿®æ”¹åï¼š**
```java
âœ… void addPipeline(CreatePipelineCommand command);
âœ… void updatePipeline(UpdatePipelineCommand command, String securityContextEncoded);
```

---

## ğŸ“Š é‡æ„ç»Ÿè®¡

### åˆ›å»ºçš„æ–‡ä»¶
- **Commandå¯¹è±¡**ï¼š8ä¸ª
  - æŒ‡ä»¤æ¨¡å—ï¼š4ä¸ª
  - è®¾å¤‡æ¨¡å—ï¼š2ä¸ª
  - ç®¡é“æ¨¡å—ï¼š2ä¸ª

- **DTOè½¬æ¢å™¨**ï¼š2ä¸ª
  - CommandDtoConverter
  - TerminalDtoConverter

### ä¿®æ”¹çš„æ–‡ä»¶
- **Serviceæ¥å£**ï¼š4ä¸ª
  - ICommandMetaService
  - ICommandTaskService
  - IDeviceService
  - IPipelineService

---

## âš ï¸ ä¸‹ä¸€æ­¥å·¥ä½œï¼ˆæ­¥éª¤4-5ï¼‰

### æ­¥éª¤4ï¼šä¿®æ”¹Serviceå®ç°ç±»
**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
```
âŒ business-domain/src/main/java/org/pms/domain/command/service/impl/CommandMetaService.java
âŒ business-domain/src/main/java/org/pms/domain/command/service/impl/CommandTaskService.java
âŒ business-domain/src/main/java/org/pms/domain/terminal/service/impl/DeviceService.java
âŒ business-domain/src/main/java/org/pms/domain/terminal/service/impl/PipelineService.java
```

**å·¥ä½œå†…å®¹ï¼š**
- ä¿®æ”¹æ–¹æ³•ç­¾åï¼Œä½¿ç”¨Commandå¯¹è±¡
- å°†Commandå¯¹è±¡è½¬æ¢ä¸ºEntityå¯¹è±¡
- è°ƒç”¨Repositoryä¿å­˜Entity

---

### æ­¥éª¤5ï¼šä¿®æ”¹Applicationå±‚Facade
**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
```
âŒ business-application/src/main/java/org/pms/application/facade/CommandFacade.java
âŒ business-application/src/main/java/org/pms/application/facade/TerminalFacade.java
```

**å·¥ä½œå†…å®¹ï¼š**
- æ³¨å…¥DTOè½¬æ¢å™¨
- åœ¨Facadeæ–¹æ³•ä¸­è°ƒç”¨è½¬æ¢å™¨
- å°†API DTOè½¬æ¢ä¸ºCommandå¯¹è±¡
- è°ƒç”¨Domainå±‚Service

---

## ğŸ¯ å½“å‰æ¶æ„çŠ¶æ€

### å·²å®Œæˆéƒ¨åˆ†
```
APIå±‚ (DTO)
    â†“
Applicationå±‚ (Converter) âœ… å·²åˆ›å»º
    â†“
Domainå±‚ (Commandå¯¹è±¡) âœ… å·²åˆ›å»º
    â†“
Domainå±‚ (Serviceæ¥å£) âœ… å·²ä¿®æ”¹
```

### å¾…å®Œæˆéƒ¨åˆ†
```
Domainå±‚ (Serviceå®ç°) âŒ å¾…ä¿®æ”¹
    â†“
Infrastructureå±‚ (Repository) âŒ å¾…ä¿®æ”¹
    â†“
Database (PO)
```

---

## ğŸ’¡ é‡è¦æç¤º

1. **ç¼–è¯‘é”™è¯¯æ˜¯æ­£å¸¸çš„**
   - Serviceæ¥å£å·²ä¿®æ”¹ï¼Œä½†å®ç°ç±»è¿˜æœªä¿®æ”¹
   - éœ€è¦å®Œæˆæ­¥éª¤4æ‰èƒ½ç¼–è¯‘é€šè¿‡

2. **ä¸è¦åˆ é™¤APIå±‚ä¾èµ–**
   - ç›®å‰Serviceå®ç°ç±»è¿˜åœ¨ä½¿ç”¨API DTO
   - å®Œæˆæ­¥éª¤4-5åæ‰èƒ½åˆ é™¤ä¾èµ–

3. **æµ‹è¯•å»ºè®®**
   - å®Œæˆæ­¥éª¤4-5åï¼Œå…ˆè¿è¡Œå•å…ƒæµ‹è¯•
   - ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡åå†åˆ é™¤ä¾èµ–

---

## ğŸ“‹ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**å»ºè®®é¡ºåºï¼š**
1. ä¿®æ”¹CommandMetaServiceå®ç°ç±»
2. ä¿®æ”¹CommandTaskServiceå®ç°ç±»
3. ä¿®æ”¹DeviceServiceå®ç°ç±»
4. ä¿®æ”¹PipelineServiceå®ç°ç±»
5. ä¿®æ”¹CommandFacade
6. ä¿®æ”¹TerminalFacade
7. è¿è¡Œæµ‹è¯•
8. åˆ é™¤domain->apiä¾èµ–
9. åˆ é™¤infrastructure->apiä¾èµ–

**éœ€è¦æˆ‘ç»§ç»­å®Œæˆæ­¥éª¤4-5å—ï¼Ÿ**

