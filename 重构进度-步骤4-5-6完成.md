# DDDæ¶æ„é‡æ„è¿›åº¦æŠ¥å‘Š - æ­¥éª¤4-5-6å®Œæˆ

## âœ… å·²å®Œæˆå·¥ä½œæ€»ç»“

### ğŸ“Š æ•´ä½“è¿›åº¦
- âœ… **æ­¥éª¤1**: åˆ›å»ºCommandå¯¹è±¡ï¼ˆ8ä¸ªæ–‡ä»¶ï¼‰
- âœ… **æ­¥éª¤2**: åˆ›å»ºApplicationå±‚DTOè½¬æ¢å™¨ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰
- âœ… **æ­¥éª¤3**: ä¿®æ”¹Domainå±‚Serviceæ¥å£ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰
- âœ… **æ­¥éª¤4**: ä¿®æ”¹Domainå±‚Repositoryæ¥å£å’ŒServiceå®ç°ï¼ˆ8ä¸ªæ–‡ä»¶ï¼‰
- âœ… **æ­¥éª¤5**: ä¿®æ”¹Triggerå±‚Controllerï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰
- âœ… **æ­¥éª¤6**: ä¿®æ”¹Infrastructureå±‚Repositoryå®ç°å’ŒConverterï¼ˆ12ä¸ªæ–‡ä»¶ï¼‰

**æ€»è®¡ä¿®æ”¹/åˆ›å»ºæ–‡ä»¶æ•°ï¼š37ä¸ª**

---

## ğŸ“ æ­¥éª¤6è¯¦ç»†æ¸…å•ï¼ˆInfrastructureå±‚ï¼‰

### 1ï¸âƒ£ Repositoryå®ç°ç±»ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰

#### âœ… CommandMetaRepository.java
- **ä¿®æ”¹å†…å®¹**ï¼š
  - `createCommandMeta(CommandMetaInsertReq)` â†’ `createCommandMeta(CreateCommandMetaCommand)`
  - `updateCommandMeta(CommandMetaUpdateReq)` â†’ `updateCommandMeta(UpdateCommandMetaCommand)`
  - è°ƒç”¨converteræ–¹æ³•ä»`insertReq2po()`æ”¹ä¸º`command2po()`
- **ä½ç½®**ï¼š`business-infrastructure/src/main/java/org/pms/infrastructure/repository/persistence/`

#### âœ… CommandTaskRepository.java
- **ä¿®æ”¹å†…å®¹**ï¼š
  - `createCommandTask(CommandTaskCreateReq)` â†’ `createCommandTask(CreateCommandTaskCommand)`
  - è°ƒç”¨converteræ–¹æ³•ä»`createReq2po()`æ”¹ä¸º`command2po()`

#### âœ… DeviceRepository.java
- **ä¿®æ”¹å†…å®¹**ï¼š
  - `insertDevice(DeviceInsertReq)` â†’ `insertDevice(CreateDeviceCommand)`
  - `updateDevice(DeviceUpdateReq, ...)` â†’ `updateDevice(UpdateDeviceCommand, ...)`
  - è°ƒç”¨converteræ–¹æ³•ä»`insertReq2PO()`æ”¹ä¸º`command2PO()`

#### âœ… PipelineRepository.java
- **ä¿®æ”¹å†…å®¹**ï¼š
  - `insertPipeline(PipelineInsertReq)` â†’ `insertPipeline(CreatePipelineCommand)`
  - `updatePipeline(PipelineUpdateReq, ...)` â†’ `updatePipeline(UpdatePipelineCommand, ...)`
  - è°ƒç”¨converteræ–¹æ³•ä»`insertReq2PO()`æ”¹ä¸º`command2PO()`

---

### 2ï¸âƒ£ Converterè½¬æ¢å™¨ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰

#### âœ… CommandMetaConverter.java
- **åˆ é™¤æ–¹æ³•**ï¼š
  - `CommandMetaPO insertReq2po(CommandMetaInsertReq)`
  - `CommandMetaPO updateReq2po(CommandMetaUpdateReq)`
- **æ–°å¢æ–¹æ³•**ï¼š
  - `CommandMetaPO command2po(CreateCommandMetaCommand)`
  - `CommandMetaPO command2po(UpdateCommandMetaCommand)`
- **ä¿ç•™æ–¹æ³•**ï¼šEntityâ†”PO, POâ†’Viewè½¬æ¢

#### âœ… CommandTaskConverter.java
- **åˆ é™¤æ–¹æ³•**ï¼š
  - `CommandTaskPO createReq2po(CommandTaskCreateReq)`
- **æ–°å¢æ–¹æ³•**ï¼š
  - `CommandTaskPO command2po(CreateCommandTaskCommand)`

#### âœ… DeviceConverter.java
- **åˆ é™¤æ–¹æ³•**ï¼š
  - `DevicePO insertReq2PO(DeviceInsertReq)`
- **æ–°å¢æ–¹æ³•**ï¼š
  - `DevicePO command2PO(CreateDeviceCommand)`

#### âœ… PipelineConverter.java
- **åˆ é™¤æ–¹æ³•**ï¼š
  - `PipelinePO insertReq2PO(PipelineInsertReq)`
- **æ–°å¢æ–¹æ³•**ï¼š
  - `PipelinePO command2PO(CreatePipelineCommand)`

---

### 3ï¸âƒ£ Mapperæ¥å£ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰

#### âœ… IDeviceMapper.java
- **ä¿®æ”¹æ–¹æ³•ç­¾å**ï¼š
  - `int updateDevice(String operatorName, DeviceUpdateReq)` 
  - â†’ `int updateDevice(String operatorName, UpdateDeviceCommand)`

#### âœ… IPipelineMapper.java
- **ä¿®æ”¹æ–¹æ³•ç­¾å**ï¼š
  - `int updatePipeline(String operatorName, PipelineUpdateReq)` 
  - â†’ `int updatePipeline(String operatorName, UpdatePipelineCommand)`

---

### 4ï¸âƒ£ MyBatis XMLæ˜ å°„æ–‡ä»¶ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰

#### âœ… device_mapper.xml
- **ä¿®æ”¹ä½ç½®**ï¼š`<update id="updateDevice">`
- **å‚æ•°å¼•ç”¨å˜æ›´**ï¼š
  - `#{deviceUpdateReq.xxx}` â†’ `#{command.xxx}`
  - æ‰€æœ‰å­—æ®µå¼•ç”¨å·²æ›´æ–°

#### âœ… pipeline_mapper.xml
- **ä¿®æ”¹ä½ç½®**ï¼š`<update id="updatePipeline">`
- **å‚æ•°å¼•ç”¨å˜æ›´**ï¼š
  - `#{pipelineUpdateReq.xxx}` â†’ `#{command.xxx}`
  - æ‰€æœ‰å­—æ®µå¼•ç”¨å·²æ›´æ–°

---

## ğŸ¯ é‡æ„æ”¶ç›Š

### âœ… å·²å®ç°
1. **å®Œå…¨è§£é™¤APIå±‚ä¾èµ–** - Infrastructureå±‚ä¸å†ä¾èµ–business-apiæ¨¡å—
2. **æ¸…æ™°çš„ä¾èµ–æ–¹å‘** - ç¬¦åˆDDDåˆ†å±‚æ¶æ„åŸåˆ™
3. **ç»Ÿä¸€çš„è½¬æ¢æ¨¡å¼** - Commandâ†’POè½¬æ¢ç»Ÿä¸€åœ¨Infrastructureå±‚
4. **ç±»å‹å®‰å…¨** - ä½¿ç”¨ä¸å¯å˜çš„Commandå¯¹è±¡

---

## ğŸ“‹ ä¸‹ä¸€æ­¥å·¥ä½œ

### â³ æ­¥éª¤7ï¼šåˆ é™¤pom.xmlä¸­çš„APIä¾èµ–
éœ€è¦ä»ä»¥ä¸‹æ–‡ä»¶ä¸­åˆ é™¤å¯¹business-apiçš„ä¾èµ–ï¼š
- `business-domain/pom.xml`
- `business-infrastructure/pom.xml`

### â³ æ­¥éª¤8ï¼šç¼–è¯‘éªŒè¯
- è¿è¡ŒMavenç¼–è¯‘ï¼š`mvn clean compile`
- æ£€æŸ¥æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯
- ä¿®å¤ä»»ä½•é—æ¼çš„API DTOå¼•ç”¨

### â³ æ­¥éª¤9ï¼šè¿è¡Œæµ‹è¯•
- è¿è¡Œå•å…ƒæµ‹è¯•
- è¿è¡Œé›†æˆæµ‹è¯•
- éªŒè¯åŠŸèƒ½æ­£å¸¸

---

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### MapStructè‡ªåŠ¨ç”Ÿæˆ
æ‰€æœ‰Converteréƒ½ä½¿ç”¨`@Mapper(componentModel = "spring")`æ³¨è§£ï¼ŒMapStructä¼šåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆå®ç°ç±»ï¼š
- `CommandMetaConverterImpl.java`
- `CommandTaskConverterImpl.java`
- `DeviceConverterImpl.java`
- `PipelineConverterImpl.java`

### MyBatiså‚æ•°æ˜ å°„
XMLä¸­çš„å‚æ•°å¼•ç”¨è§„åˆ™ï¼š
- å•ä¸ªå‚æ•°å¯¹è±¡ï¼šç›´æ¥ä½¿ç”¨`#{å±æ€§å}`
- å¤šä¸ªå‚æ•°ï¼šä½¿ç”¨`@Param`æ³¨è§£æˆ–å‚æ•°åå¼•ç”¨`#{å‚æ•°å.å±æ€§å}`

---

## ğŸ” éœ€è¦æ³¨æ„çš„ç‚¹

1. **ç¼–è¯‘é¡ºåº**ï¼šå…ˆç¼–è¯‘Domainå±‚ï¼Œå†ç¼–è¯‘Infrastructureå±‚
2. **MapStructç‰ˆæœ¬**ï¼šç¡®ä¿MapStructç‰ˆæœ¬å…¼å®¹Java 17
3. **MyBatisç¼“å­˜**ï¼šä¿®æ”¹XMLåå¯èƒ½éœ€è¦æ¸…ç†MyBatisç¼“å­˜
4. **æµ‹è¯•è¦†ç›–**ï¼šé‡ç‚¹æµ‹è¯•createå’Œupdateæ“ä½œ

---

**ä¸‹ä¸€æ­¥å»ºè®®**ï¼šåˆ é™¤pom.xmlä¾èµ–å¹¶è¿è¡Œç¼–è¯‘éªŒè¯

