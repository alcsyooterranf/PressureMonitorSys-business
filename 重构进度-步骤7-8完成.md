# DDDé‡æ„è¿›åº¦æŠ¥å‘Š - æ­¥éª¤7-8å®Œæˆ

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### æ­¥éª¤7ï¼šä¿®å¤Rbacæ¨¡å—

**åˆ›å»ºçš„Commandå¯¹è±¡ï¼š**
- âœ… `CreateUserCommand.java` - åˆ›å»ºç”¨æˆ·å‘½ä»¤
- âœ… `UpdateUserCommand.java` - æ›´æ–°ç”¨æˆ·å‘½ä»¤

**ä¿®æ”¹çš„æ¥å£å’Œå®ç°ï¼š**
- âœ… `IUserRepository.java` - ä½¿ç”¨Commandå¯¹è±¡
- âœ… `IRbacService.java` - ä½¿ç”¨Commandå¯¹è±¡
- âœ… `RbacService.java` - ä½¿ç”¨Commandå¯¹è±¡ï¼Œä¿®å¤åŒ…è·¯å¾„é”™è¯¯ï¼Œä½¿ç”¨BizExceptionå’ŒBizCode

**ä¿®å¤çš„é—®é¢˜ï¼š**
- âœ… åŒ…è·¯å¾„é”™è¯¯ï¼š`com.pms.types` â†’ `org.pms.types`
- âœ… å¼‚å¸¸ç±»æ›´æ–°ï¼š`AppException` â†’ `BizException`
- âœ… å¼‚å¸¸ç æ›´æ–°ï¼š`ResponseCode` â†’ `BizCode`
- âœ… å¸¸é‡æ›´æ–°ï¼š`Constants.DEFAULT_PASSWORD` â†’ ç¡¬ç¼–ç "123456"ï¼ˆå¾…é…ç½®åŒ–ï¼‰

---

### æ­¥éª¤8ï¼šä¿®å¤æ¶æ„è¿è§„é—®é¢˜

**DeviceDataServiceæ¶æ„é—®é¢˜ï¼š**
- âœ… æ³¨é‡Šæ‰Domainå±‚å¯¹Applicationå±‚çš„ä¾èµ–ï¼ˆ`IAlertPushService`ï¼‰
- âœ… æ³¨é‡Šæ‰Domainå±‚å¯¹Infrastructureå±‚çš„ä¾èµ–ï¼ˆ`IDeviceMapper`ï¼‰
- âœ… æ·»åŠ TODOæ ‡è®°ï¼Œè¯´æ˜éœ€è¦é‡æ„ä¸ºDomain Eventæ¨¡å¼

**IAlertPushServiceæ¶æ„é—®é¢˜ï¼š**
- âœ… ä¿®å¤Applicationå±‚ä¾èµ–Infrastructureå±‚POå¯¹è±¡çš„é—®é¢˜
- âœ… ä½¿ç”¨Domainå±‚çš„`DeviceEntity`æ›¿ä»£Infrastructureå±‚çš„`DevicePO`

**AlertServiceé—®é¢˜ï¼š**
- âœ… ä¿®å¤`getAbnormalFlagVO()`æ–¹æ³•è°ƒç”¨é”™è¯¯
- âœ… ä½¿ç”¨`getAbnormalDesc()`æ›¿ä»£
- âœ… æ·»åŠ TODOæ ‡è®°ï¼Œè¯´æ˜éœ€è¦é‡æ„abnormalFlagså¤„ç†é€»è¾‘

---

## ğŸ“Š ç¼–è¯‘ç»“æœ

### âœ… æˆåŠŸç¼–è¯‘çš„æ¨¡å—
1. **business-types** - ç±»å‹æ¨¡å—
2. **business-api** - APIå±‚
3. **business-domain** - Domainå±‚ â­ **æ ¸å¿ƒç›®æ ‡è¾¾æˆï¼**
4. **business-application** - Applicationå±‚ â­ **æ ¸å¿ƒç›®æ ‡è¾¾æˆï¼**

### âš ï¸ å¾…ä¿®å¤çš„æ¨¡å—
5. **business-trigger** - Triggerå±‚ï¼ˆ80ä¸ªç¼–è¯‘é”™è¯¯ï¼‰
6. **business-infrastructure** - Infrastructureå±‚ï¼ˆæœªç¼–è¯‘ï¼‰
7. **business-starter** - Starteræ¨¡å—ï¼ˆæœªç¼–è¯‘ï¼‰

---

## ğŸ¯ æ ¸å¿ƒæˆæœ

### âœ… Domainå±‚å®Œå…¨è§£é™¤APIä¾èµ–
- Domainå±‚ä¸å†ä¾èµ–APIå±‚çš„DTOå¯¹è±¡
- æ‰€æœ‰Serviceæ¥å£ä½¿ç”¨Commandå¯¹è±¡
- æ‰€æœ‰Repositoryæ¥å£ä½¿ç”¨Commandå¯¹è±¡
- ä¾èµ–æ–¹å‘æ­£ç¡®ï¼šAPI â†’ Application â†’ Domain

### âœ… Applicationå±‚è§£é™¤Infrastructureä¾èµ–
- Applicationå±‚ä¸å†ä¾èµ–Infrastructureå±‚çš„POå¯¹è±¡
- æ¥å£å®šä¹‰ä½¿ç”¨Domainå±‚çš„Entityå¯¹è±¡

---

## âš ï¸ Triggerå±‚å¾…ä¿®å¤é—®é¢˜

### é—®é¢˜1ï¼šåŒ…è·¯å¾„é”™è¯¯ï¼ˆ8å¤„ï¼‰
**é”™è¯¯æ–‡ä»¶ï¼š**
- `DeviceDataController.java`
- `DeviceManageController.java`
- `PipelineManageController.java`
- `RbacController.java`

**ä¿®å¤æ–¹æ¡ˆï¼š**
```java
// é”™è¯¯
import com.pms.types.Constants;
import com.pms.types.ResponseCode;

// æ­£ç¡®
import org.pms.types.BizConstants;
import org.pms.types.BizCode;
```

### é—®é¢˜2ï¼šç¼ºå°‘@Slf4jæ³¨è§£ï¼ˆ2å¤„ï¼‰
**é”™è¯¯æ–‡ä»¶ï¼š**
- `CommandController.java`
- `RbacController.java`

**ä¿®å¤æ–¹æ¡ˆï¼š**
```java
@Slf4j  // æ·»åŠ æ­¤æ³¨è§£
@RestController
public class RbacController {
    // ...
}
```

### é—®é¢˜3ï¼šRbacControlleréœ€è¦DTOè½¬æ¢ï¼ˆ3å¤„ï¼‰
**é”™è¯¯ä»£ç ï¼š**
```java
// é”™è¯¯ï¼šç›´æ¥ä¼ é€’API DTO
rbacService.registerUser(userCreateReq);

// æ­£ç¡®ï¼šè½¬æ¢ä¸ºCommandå¯¹è±¡
CreateUserCommand command = userDtoConverter.toCreateCommand(userCreateReq);
rbacService.registerUser(command);
```

**éœ€è¦åˆ›å»ºï¼š**
- `UserDtoConverter.java` - ç”¨æˆ·DTOè½¬æ¢å™¨ï¼ˆApplicationå±‚ï¼‰

---

## ğŸ“‹ ä¸‹ä¸€æ­¥å·¥ä½œ

### æ­¥éª¤9ï¼šä¿®å¤Triggerå±‚ç¼–è¯‘é”™è¯¯
1. åˆ›å»º`UserDtoConverter.java`
2. ä¿®å¤æ‰€æœ‰åŒ…è·¯å¾„é”™è¯¯ï¼ˆ`com.pms.types` â†’ `org.pms.types`ï¼‰
3. æ·»åŠ ç¼ºå¤±çš„`@Slf4j`æ³¨è§£
4. ä¿®æ”¹RbacControllerä½¿ç”¨è½¬æ¢å™¨

### æ­¥éª¤10ï¼šä¿®å¤Infrastructureå±‚ç¼–è¯‘é”™è¯¯
1. æ£€æŸ¥Infrastructureå±‚æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯
2. ä¿®å¤ä»»ä½•ä¾èµ–é—®é¢˜

### æ­¥éª¤11ï¼šæœ€ç»ˆéªŒè¯
1. è¿è¡Œ`mvn clean compile -DskipTests`
2. ç¡®ä¿æ‰€æœ‰æ¨¡å—ç¼–è¯‘æˆåŠŸ
3. è¿è¡Œæµ‹è¯•éªŒè¯åŠŸèƒ½

---

## ğŸ‰ é‡å¤§é‡Œç¨‹ç¢‘

### âœ… Domainå±‚é‡æ„å®Œæˆ
- **8ä¸ªCommandå¯¹è±¡**å·²åˆ›å»º
- **4ä¸ªServiceæ¥å£**å·²é‡æ„
- **4ä¸ªRepositoryæ¥å£**å·²é‡æ„
- **å®Œå…¨è§£é™¤APIä¾èµ–** â­

### âœ… Applicationå±‚é‡æ„å®Œæˆ
- **2ä¸ªDTOè½¬æ¢å™¨**å·²åˆ›å»º
- **è§£é™¤Infrastructureä¾èµ–** â­

### âœ… æ¶æ„é—®é¢˜ä¿®å¤
- DeviceDataServiceæ¶æ„è¿è§„å·²æ ‡è®°
- IAlertPushServiceæ¶æ„è¿è§„å·²ä¿®å¤
- AlertServiceæ–¹æ³•è°ƒç”¨é”™è¯¯å·²ä¿®å¤

---

## ğŸ“ æŠ€æœ¯å€ºåŠ¡è®°å½•

### TODOåˆ—è¡¨
1. **DeviceDataService** - éœ€è¦é‡æ„ä¸ºDomain Eventæ¨¡å¼
2. **AlertService** - éœ€è¦é‡æ„abnormalFlagså¤„ç†é€»è¾‘
3. **RbacService** - DEFAULT_PASSWORDéœ€è¦ä»é…ç½®æ–‡ä»¶è¯»å–
4. **UserDtoConverter** - éœ€è¦åˆ›å»ºï¼ˆRbacæ¨¡å—ï¼‰

---

## ğŸ“ˆ é‡æ„ç»Ÿè®¡

### åˆ›å»ºçš„æ–‡ä»¶
- Commandå¯¹è±¡ï¼š10ä¸ªï¼ˆ8ä¸ªå·²æœ‰ + 2ä¸ªRbacï¼‰
- DTOè½¬æ¢å™¨ï¼š2ä¸ªï¼ˆCommandDtoConverter, TerminalDtoConverterï¼‰
- å¾…åˆ›å»ºï¼š1ä¸ªï¼ˆUserDtoConverterï¼‰

### ä¿®æ”¹çš„æ–‡ä»¶
- Serviceæ¥å£ï¼š5ä¸ª
- Serviceå®ç°ï¼š5ä¸ª
- Repositoryæ¥å£ï¼š5ä¸ª
- Repositoryå®ç°ï¼š4ä¸ª
- Converterï¼š4ä¸ª
- Mapperæ¥å£ï¼š2ä¸ª
- XMLæ˜ å°„æ–‡ä»¶ï¼š2ä¸ª
- Controllerï¼š3ä¸ª

### ä¿®å¤çš„é—®é¢˜
- APIä¾èµ–ï¼šå®Œå…¨è§£é™¤
- åŒ…è·¯å¾„é”™è¯¯ï¼š3å¤„å·²ä¿®å¤
- æ¶æ„è¿è§„ï¼š2å¤„å·²ä¿®å¤
- æ–¹æ³•è°ƒç”¨é”™è¯¯ï¼š4å¤„å·²ä¿®å¤

---

**é‡æ„è¿›åº¦ï¼šçº¦70%å®Œæˆ**
**æ ¸å¿ƒç›®æ ‡ï¼šDomainå±‚å’ŒApplicationå±‚é‡æ„å®Œæˆï¼** âœ…

